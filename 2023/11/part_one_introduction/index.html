<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Building a Virtual Machine Lab Part 1: Introduction - cat /usr/share</title><meta name=Description content="Introduction to a blog series about building a reversing lab with VMWare"><meta property="og:title" content="Building a Virtual Machine Lab Part 1: Introduction">
<meta property="og:description" content="Introduction to a blog series about building a reversing lab with VMWare"><meta property="og:type" content="article"><meta property="og:url" content="https://philmish.github.io/2023/11/part_one_introduction/"><meta property="og:image" content="https://philmish.github.io/logo.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-26T00:00:00+00:00"><meta property="article:modified_time" content="2023-11-26T00:00:00+00:00"><meta property="og:site_name" content="ls /usr/share"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://philmish.github.io/logo.png"><meta name=twitter:title content="Building a Virtual Machine Lab Part 1: Introduction"><meta name=twitter:description content="Introduction to a blog series about building a reversing lab with VMWare"><meta name=application-name content="Philmish's Blog"><meta name=apple-mobile-web-app-title content="Philmish's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://philmish.github.io/2023/11/part_one_introduction/><link rel=prev href=https://philmish.github.io/2023/11/bash_scripting/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Building a Virtual Machine Lab Part 1: Introduction","inLanguage":"en-us","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/philmish.github.io\/2023\/11\/part_one_introduction\/"},"genre":"posts","keywords":"Practical Malware Analysis, Writeup, Reverse Engineering, Learning","wordcount":866,"url":"https:\/\/philmish.github.io\/2023\/11\/part_one_introduction\/","datePublished":"2023-11-26T00:00:00+00:00","dateModified":"2023-11-26T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"philmish"},"description":"Introduction to a blog series about building a reversing lab with VMWare"}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"dark"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"dark"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="cat /usr/share"><span class=header-title-pre><i class='fa-solid fa-terminal' aria-hidden=true></i></span><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=Posts><i class="fa-solid fa-file"></i> </a><a class=menu-item href=/tags/ title=Tags><i class="fa-solid fa-tag"></i> </a><a class=menu-item href=/categories/ title=Categories><i class="fa-solid fa-sitemap"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="cat /usr/share"><span class=header-title-pre><i class='fa-solid fa-terminal' aria-hidden=true></i></span><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title=Posts><i class="fa-solid fa-file"></i></a><a class=menu-item href=/tags/ title=Tags><i class="fa-solid fa-tag"></i></a><a class=menu-item href=/categories/ title=Categories><i class="fa-solid fa-sitemap"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Building a Virtual Machine Lab Part 1: Introduction</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://philmish.github.io/ title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>philmish</a></span>&nbsp;<span class=post-category>included in <a href=/categories/learning/><i class="far fa-folder fa-fw" aria-hidden=true></i>Learning</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-11-26>2023-11-26</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;866 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#motivation>Motivation</a></li><li><a href=#planning>Planning</a></li><li><a href=#the-host>The Host</a></li><li><a href=#network-segments>Network Segments</a></li><li><a href=#the-virtual-machines>The Virtual Machines</a><ul><li><a href=#pfsense>pfSense</a></li><li><a href=#ips-machine>IPS Machine</a></li><li><a href=#siem>SIEM</a></li><li><a href=#remnux>Remnux</a></li><li><a href=#reversing-machine>Reversing Machine</a></li></ul></li><li><a href=#the-goal>The Goal</a></li></ul></nav></div></div><div class=content id=content><h2 id=motivation>Motivation</h2><p>Not to long ago I started to work on the training material provided by <a href=https://nostarch.com/malware target=_blank rel="noopener noreffer">Practical Malware Analysis</a> using a pretty basic VM setup by assigning the Reversing Windows VM no network adapter after installing all the tools I wanted and called it a day.</p><p>This would be sufficient to avoid unwanted network communication from the machine. Additional I made sure there is no mounted file shares to avoid accidentally installing malicious/unwanted stuff to my actual machine.</p><p>Even though this would be enough to do the static analysis parts of the book without the danger of installing unwanted stuff to the host, it would not suffice for any dynamic analysis. While researching sources to figure out how to setup a VM lab environment which would make sure there is as little as possible chance that something could escape from my reversing machine to keep my host save. I know, as these are pretty old samples the book is working with there is little chance that something actually bad happens, but eh I am paranoid and ready to learn.</p><h2 id=planning>Planning</h2><p>After some research I found <a href=https://leanpub.com/avatar2 target=_blank rel="noopener noreffer">Building Virtual Machine Labs: A Hands-on Guide (Second Edition)</a>.
This book provides a Hands-On Guide for setting up virtual machine labs for 3 different hypervisors. I can recommend it to anyone who wants to get into building a little bit more involved VM Labs than what I described above. It goes into detail about setting up some basic networking and describes the specific setups required for building a lab used for learning offensive Cyber Security with Boot To Root machines.</p><p>I will use the scenario described in the book as basis for building my reversing lab.</p><p>As a tl;dr for what the book describes, we will setup 3 Network segments to manage the virtual machines. At the core of the setup is a <code>pfSense</code> firewall VM, which will be responsible to for managing the access of the different machines to other networks.
Outbound communication to the internet will be provided through the <code>pfSense</code> VM, which will be connected to a virtual bridge network. All access will be managed through firewall settings.</p><h2 id=the-host>The Host</h2><p>As a rough outline for what I am working with:</p><p>Host:
- Windows 10
- 32gb of RAM
- 500 GB SSD
- AMD Ryzen 3600 6-Core</p><p>I chose to use <code>VMWare Workstation 17</code>, as it was available to me</p><h2 id=network-segments>Network Segments</h2><p>There will exist 3 network segments providing a different level of access to resources in the lab, like other segments/networks and hosts.</p><ul><li>Management, this network will be used for interfaces which should have access to outbound https traffic, it will use the <a href=https://docs.vmware.com/en/VMware-Workstation-Player-for-Windows/17.0/com.vmware.player.win.using.doc/GUID-93BDF7F1-D2E4-42CE-80EA-4E305337D2FC.html target=_blank rel="noopener noreffer">Host Only Network</a></li><li>IPS, this network will be used for interfaces which should have a more restricted and/or proxied access to other networks, it will be a virtual network</li><li>Lab, this network will be used by interfaces which should be isolated from all other networks and the host itself, the reversing and monitoring VMs interfaces will be connected to this virtual network, this will be a segment of the IPS Network</li></ul><p>The <code>IPS</code> and <code>Lab</code> segments are both part of the same virtual Network.</p><h2 id=the-virtual-machines>The Virtual Machines</h2><h3 id=pfsense>pfSense</h3><ul><li>OpenBSD</li><li><a href=https://www.pfsense.org/download/ target=_blank rel="noopener noreffer">Official Community Edition ISO</a></li><li>manages network communication and DHCP for the virtual networks</li><li>available to the Host machine through the IPS Management network</li><li>configured over the web interface</li><li>1 Core, 1024 Mb RAM</li><li>8 GB Storage</li><li>Network Interfaces:<ul><li>WAN (bridged) Local Network DHCP</li><li>LAN (Management Network) Host Only 172.16.1.1/24</li><li>OPT1 (IPS Network) Virtual Network 172.16.2.1/24</li></ul></li></ul><h3 id=ips-machine>IPS Machine</h3><ul><li>Ubuntu Server 22.04</li><li>running <a href=https://www.snort.org/ target=_blank rel="noopener noreffer">Snort</a> with community rules</li><li>1 Core, 4GB RAM</li><li>55 GB Storage</li><li>will be used occasionally for log collection</li><li>Network interfaces:<ul><li>eth0 (Management Network) 172.16.1.4/24</li><li>eth1,2 used with AFPACKET to bridge communication between IPS and Lab segments (will not have an IP)</li></ul></li></ul><h3 id=siem>SIEM</h3><ul><li>Ubuntu Server 22.04</li><li>running <a href=https://github.com/elastic/elasticsearch target=_blank rel="noopener noreffer">Elasticsearch</a> and <a href=https://www.elastic.co/kibana target=_blank rel="noopener noreffer">Kibana</a></li><li>2 Core, 8 GB RAM</li><li>75 GB Storage</li><li>will be used occasionally for log parsing/visualizing</li><li>spoiler: this machine should be assigned a lot more resources, as soon as I can upgrade RAM on the host this machine will be used more</li><li>Network Interfaces:<ul><li>eth0 (Management Network) 172.16.1.2/24</li></ul></li></ul><h3 id=remnux>Remnux</h3><ul><li><a href=https://remnux.org/ target=_blank rel="noopener noreffer">Remnux ISO</a></li><li>used to provide tools for analysis on a Linux Platform</li><li>will be used to provide local analysis tool for static analysis</li><li>will be used for dynamic analysis with <a href=https://www.inetsim.org/ target=_blank rel="noopener noreffer">Inetsim</a></li><li>1 Core 8 GB RAM</li><li>60 GB Storage</li><li>Network Interfaces<ul><li>eth0 (Lab Network) 172.16.2.2/24</li></ul></li></ul><h3 id=reversing-machine>Reversing Machine</h3><ul><li>Windows 10</li><li>used for isolated analysis of samples</li><li>put under complete lock down by the pfSense VM</li><li>will use Remnux as a DNS to pass all traffic to <code>Inetsim</code></li><li>2 Cores, 8 GB RAM</li><li>90 GB Storage</li><li>Network Interfaces<ul><li>eth0 (Lab Network) 172.16.2.3/24</li></ul></li></ul><h2 id=the-goal>The Goal</h2><p>My main goal for this project is to get the network and virtual machines setup, set up the firewall configuration to enable restricted communication for the VMs, set up <code>Inetsim</code> on the <code>Remnux</code> VM and test tracking the network communication of the Reversing Machine.</p><p><figure><a class=lightgallery href=/images/network_vmware_lab.png title=Network data-thumbnail=/images/network_vmware_lab.png data-sub-html="<h2>Network Plan for the Lab</h2><p>Network</p>"><img class=lazyload src=/svg/loading.min.svg data-src=/images/network_vmware_lab.png data-srcset="/images/network_vmware_lab.png, /images/network_vmware_lab.png 1.5x, /images/network_vmware_lab.png 2x" data-sizes=auto alt=/images/network_vmware_lab.png width=1072 height=1042></a><figcaption class=image-caption>Network Plan for the Lab</figcaption></figure></p><p>This wraps up the introduction to what I am going to document in the following parts of this blog series.
In the next part I will configure VMWare and the host and set up the pfSense Firewall</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-11-26</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://philmish.github.io/2023/11/part_one_introduction/ data-title="Building a Virtual Machine Lab Part 1: Introduction" data-hashtags="Practical Malware Analysis,Writeup,Reverse Engineering,Learning"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://philmish.github.io/2023/11/part_one_introduction/ data-hashtag="Practical Malware Analysis"><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://philmish.github.io/2023/11/part_one_introduction/ data-title="Building a Virtual Machine Lab Part 1: Introduction"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://philmish.github.io/2023/11/part_one_introduction/ data-title="Building a Virtual Machine Lab Part 1: Introduction"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://philmish.github.io/2023/11/part_one_introduction/ data-title="Building a Virtual Machine Lab Part 1: Introduction"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/practical-malware-analysis/>Practical Malware Analysis</a>,&nbsp;<a href=/tags/writeup/>Writeup</a>,&nbsp;<a href=/tags/reverse-engineering/>Reverse Engineering</a>,&nbsp;<a href=/tags/learning/>Learning</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/2023/11/bash_scripting/ class=prev rel=prev title="Bash Scripting Reference"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Bash Scripting Reference</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://philmish.github.io/ target=_blank>philmish</a></span>&nbsp;|&nbsp;<span class=license><a rel="This is free and unencumbered software released into the public domain." href=https://unlicense.org target=_blank>The Unlicense</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/algoliasearch@4.13.1/dist/algoliasearch-lite.umd.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@14.0.2/dist/twemoji.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},data:{"id-1":"ls /usr/share","id-2":"ls /usr/share"},lightgallery:!0,search:{algoliaAppID:"",algoliaIndex:"",algoliaSearchKey:"",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"},twemoji:!0,typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>